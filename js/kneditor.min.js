!function(e){"use strict";"function"==typeof define&&define.amd?define([],function(){return e(window,document)}):"undefined"!=typeof exports?module.exports=e(window,document):window.wysiwyg=e(window,document)}(function(e,t){"use strict";var n=function(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var i=this,o=arguments;r=setTimeout(function(){r=null,e.apply(i,o)},t)}},r=function(t,n,r,i){t.addEventListener?t.addEventListener(n,r,!!i):t.attachEvent?t.attachEvent("on"+n,r):t!=e&&(t["on"+n]=r)},i=function(t,n,r,i){t.removeEventListener?t.removeEventListener(n,r,!!i):t.detachEvent?t.detachEvent("on"+n,r):t!=e&&(t["on"+n]=null)},o=function(e,n,r,i){if(t.createEvent)(o=t.createEvent("Event")).initEvent(n,void 0===r||r,void 0!==i&&i),e.dispatchEvent(o);else if(t.createEventObject){var o=t.createEventObject();e.fireEvent("on"+n,o)}else"function"==typeof e["on"+n]&&e["on"+n]()},a=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},l="undefined"!=typeof Node?Node.ELEMENT_NODE:1,u="undefined"!=typeof Node?Node.TEXT_NODE:3,f=function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1},c=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null},s=function(n){if(e.getSelection){if((r=e.getSelection()).rangeCount>0)return r.getRangeAt(0)}else if(t.selection){var r=t.selection;return r.createRange()}return null},d=function(n,r){if(r)if(e.getSelection){var i=e.getSelection();i.removeAllRanges(),i.addRange(r)}else t.selection&&r.select()},g=function(){if(e.getSelection){if(!(o=e.getSelection()).rangeCount)return!1;if((a=o.getRangeAt(0).cloneRange()).getBoundingClientRect){var n=a.getBoundingClientRect();if(n&&n.left&&n.top&&n.right&&n.bottom)return{left:parseInt(n.left),top:parseInt(n.top),width:parseInt(n.right-n.left),height:parseInt(n.bottom-n.top)};for(var r=a.getClientRects?a.getClientRects():[],i=0;i<r.length;++i)if((n=r[i]).left&&n.top&&n.right&&n.bottom)return{left:parseInt(n.left),top:parseInt(n.top),width:parseInt(n.right-n.left),height:parseInt(n.bottom-n.top)}}}else if(t.selection){var o=t.selection;if("Control"!=o.type){var a=o.createRange();if(a.boundingLeft||a.boundingTop||a.boundingWidth||a.boundingHeight)return{left:a.boundingLeft,top:a.boundingTop,width:a.boundingWidth,height:a.boundingHeight}}}return!1},p=function(n){if(e.getSelection)return!!(r=e.getSelection()).isCollapsed;if(t.selection){var r=t.selection;if("Text"==r.type){var i=t.selection.createRange(),o=t.body.createTextRange();return o.moveToElementText(n),o.setEndPoint("EndToStart",i),0==i.htmlText.length}if("Control"==r.type)return!1}return!0},h=function(n){if(e.getSelection){if(!(s=e.getSelection()).rangeCount)return[];for(var r=[],i=0;i<s.rangeCount;++i)for(var o=(m=s.getRangeAt(i)).startContainer,a=m.endContainer;o;){if(o!=n){var u=!1;if(s.containsNode)u=s.containsNode(o,!0);else{(p=t.createRange()).selectNodeContents(o);for(i=0;i<s.rangeCount;++i)if((m=s.getRangeAt(i)).compareBoundaryPoints(m.END_TO_START,p)>=0&&m.compareBoundaryPoints(m.START_TO_END,p)<=0){u=!0;break}}u&&r.push(o)}o=c(o,o==a?a:n)}return 0==r.length&&f(n,s.focusNode)&&s.focusNode!=n&&r.push(s.focusNode),r}if(t.selection){var s=t.selection;if("Text"==s.type){for(var r=[],d=s.createRangeCollection(),i=0;i<d.length;++i)for(var g=(m=d[i]).parentElement(),o=g;o;){var p=m.duplicate();if(p.moveToElementText(o.nodeType!=l?o.parentNode:o),p.compareEndPoints("EndToStart",m)>=0&&p.compareEndPoints("StartToEnd",m)<=0){for(var h=!1,v=0;v<r.length;++v)if(r[v]===o){h=!0;break}h||r.push(o)}o=c(o,g)}return 0==r.length&&f(n,t.activeElement)&&t.activeElement!=n&&r.push(t.activeElement),r}if("Control"==s.type){for(var r=[],m=s.createRange(),i=0;i<m.length;++i)r.push(m(i));return r}}return[]},v=function(){if(e.getSelection){if(!(n=e.getSelection()).isCollapsed)try{n.collapseToEnd()}catch(e){}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var r=n.createRange();r.collapse(!1),r.select()}}},m=function(n,r,i){if(e.getSelection)if((a=e.getSelection()).modify){for(o=0;o<r;++o)a.modify("extend","backward","character");for(var o=0;o<i;++o)a.modify("extend","forward","character")}else(l=a.getRangeAt(0)).setStart(l.startContainer,l.startOffset-r),l.setEnd(l.endContainer,l.endOffset+i),a.removeAllRanges(),a.addRange(l);else if(t.selection){var a=t.selection;if("Control"!=a.type){var l=a.createRange();l.collapse(!0),l.moveStart("character",-r),l.moveEnd("character",i),l.select()}}},y=function(n){if(p(n))return null;if(e.getSelection){if((l=e.getSelection()).rangeCount){for(var r=t.createElement("div"),i=l.rangeCount,o=0;o<i;++o){var a=l.getRangeAt(o).cloneContents();r.appendChild(a)}return r.innerHTML}}else if(t.selection){var l=t.selection;if("Text"==l.type)return l.createRange().htmlText}return null},b=function(n,r){if(e.getSelection){var i=e.getSelection();if(f(n,i.anchorNode)&&f(n,i.focusNode))return!0;if(!r)return!1;(a=t.createRange()).selectNodeContents(n),a.collapse(!1),i.removeAllRanges(),i.addRange(a)}else if(t.selection){if("Control"==(i=t.selection).type){if(0!=(a=i.createRange()).length&&f(n,a(0)))return!0}else{var o=t.body.createTextRange();o.moveToElementText(n);var a=i.createRange();if(o.inRange(a))return!0}if(!r)return!1;(a=t.body.createTextRange()).moveToElementText(n),a.setEndPoint("StartToEnd",a),a.select()}return!0},T=function(n,r){if(e.getSelection){if((c=e.getSelection()).getRangeAt&&c.rangeCount){var i=c.getRangeAt(0),o=t.createElement("div");o.innerHTML=r;for(var a,l,u=t.createDocumentFragment();a=o.firstChild;)l=u.appendChild(a);f(n,i.commonAncestorContainer)?(i.deleteContents(),i.insertNode(u)):n.appendChild(u),l&&((i=i.cloneRange()).setStartAfter(l),i.collapse(!0),c.removeAllRanges(),c.addRange(i))}}else if(t.selection){var c=t.selection;if("Control"!=c.type){var s=c.createRange();s.collapse(!0);i=c.createRange();if(f(n,i.parentElement()))i.pasteHTML(r);else{var d=t.body.createTextRange();d.moveToElementText(n),d.collapse(!1),d.select(),d.pasteHTML(r)}(i=c.createRange()).setEndPoint("StartToEnd",s),i.select()}}};return function(E){var C=(E=E||{}).element||null;"string"==typeof C&&(C=t.getElementById(C));var R=E.contenteditable||null;"string"==typeof R&&(R=t.getElementById(R));var S=E.onKeyDown||null,L=E.onKeyPress||null,N=E.onKeyUp||null,A=E.onSelection||null,x=E.onPlaceholder||null,M=E.onOpenpopup||null,w=E.onClosepopup||null,I=E.hijackContextmenu||!1,H=E.readOnly||!1,k="TEXTAREA"==C.nodeName||"INPUT"==C.nodeName;if(k){var O="contentEditable"in t.body;if(O){var P=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);P&&420<=parseInt(P[1])&&parseInt(P[1])<534&&(O=!1)}if(!O){var D=function(e){return e.replace(/<br[ \/]*>\n?/gi,"<br>\n")};(F=C).value=D(F.value);var B=function(){return this},j=function(){return null};return{legacy:!0,getElement:function(){return F},getHTML:function(){return F.value},setHTML:function(e){return F.value=D(e),this},getSelectedHTML:j,sync:B,readOnly:function(e){return void 0===e?F.hasAttribute?F.hasAttribute("readonly"):!!F.getAttribute("readonly"):(e?F.setAttribute("readonly","readonly"):F.removeAttribute("readonly"),this)},collapseSelection:B,expandSelection:B,openPopup:j,closePopup:B,removeFormat:B,bold:B,italic:B,underline:B,strikethrough:B,forecolor:B,highlight:B,fontName:B,fontSize:B,subscript:B,superscript:B,align:B,format:B,indent:B,insertLink:B,insertImage:B,insertHTML:B,insertList:B}}}var F=null,K=null;if(k)if(F=C,F.style.display="none",R)K=R;else{(K=t.createElement("DIV")).innerHTML=F.value||"";var X=F.parentNode,W=F.nextSibling;W?X.insertBefore(K,W):X.appendChild(K)}else K=C;H||K.setAttribute("contentEditable","true");var Y,_=t.all&&(!t.documentMode||t.documentMode<=8)?t:e,V=null;if(k){var U=K.innerHTML;V=function(){var e=K.innerHTML;e!=U&&(F.value=e,U=e,o(F,"change",!1))};var q=F.form;q&&r(q,"reset",function(){K.innerHTML="",V(),Y(!0)})}var z;if(x){var G=!1;(z=function(){for(var e=!0,t=K;t;)if(t=c(t,K))if(t.nodeType==l){if("IMG"==t.nodeName){e=!1;break}}else if(t.nodeType==u){var n=t.nodeValue;if(n&&-1!=n.search(/[^\s]/)){e=!1;break}}G!=e&&(x(e),G=e)})()}var J=null,Q=null;A&&(Q=n(function(t,n,r){var i=p(K),o=h(K),a=null===t||null===n?null:{left:t,top:n,width:0,height:0},u=g();if(u&&(a=u),a){if(K.getBoundingClientRect){var f=K.getBoundingClientRect();a.left-=parseInt(f.left),a.top-=parseInt(f.top)}else{var c=K,s=0,d=0,v=!1;do{s+=c.offsetLeft?parseInt(c.offsetLeft):0,d+=c.offsetTop?parseInt(c.offsetTop):0,"fixed"==c.style.position&&(v=!0)}while(c=c.offsetParent);a.left-=s-(v?0:e.pageXOffset),a.top-=d-(v?0:e.pageYOffset)}a.left<0&&(a.left=0),a.top<0&&(a.top=0),a.width>K.offsetWidth&&(a.width=K.offsetWidth),a.height>K.offsetHeight&&(a.height=K.offsetHeight)}else if(o.length)for(var m=0;m<o.length;++m)if((c=o[m]).nodeType==l){a={left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight};break}A(i,a,o,r)},1));var Z=null,$=function(t){if(!t)var t=e.event;var n=t.target||t.srcElement;n.nodeType==u&&(n=n.parentNode),f(Z,n)||te()},ee=function(){if(Z)return Z;r(_,"mousedown",$,!0),Z=t.createElement("DIV");var e=K.parentNode,n=K.nextSibling;return n?e.insertBefore(Z,n):e.appendChild(Z),M&&M(),Z},te=function(){Z&&(Z.parentNode.removeChild(Z),Z=null,i(_,"mousedown",$,!0),w&&w())};r(K,"focus",function(){F&&o(F,"focus",!1)}),r(K,"blur",function(){V&&V(),F&&o(F,"blur",!1)});var ne=null;if(z||V){var re=V?n(V,250,!0):null;ne=n(function(e){z&&z(),re&&re()},1),r(K,"input",ne),r(K,"DOMNodeInserted",ne),r(K,"DOMNodeRemoved",ne),r(K,"DOMSubtreeModified",ne),r(K,"DOMCharacterDataModified",ne),r(K,"propertychange",ne),r(K,"textInput",ne),r(K,"paste",ne),r(K,"cut",ne),r(K,"drop",ne)}var ie=function(t,n){if(!t)var t=e.event;var r=t.which||t.keyCode,i=String.fromCharCode(r||t.charCode),o=t.shiftKey||!1,l=t.altKey||!1,u=t.ctrlKey||!1,f=t.metaKey||!1;if(1==n){if(S&&!1===S(r,i,o,l,u,f))return a(t)}else if(2==n){if(L&&!1===L(r,i,o,l,u,f))return a(t)}else if(3==n&&N&&!1===N(r,i,o,l,u,f))return a(t);if(2!=n&&3!=n||(J=null,Q&&Q(null,null,!1)),2==n&&ne)switch(r){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:ne()}};r(K,"keydown",function(e){return ie(e,1)}),r(K,"keypress",function(e){return ie(e,2)}),r(K,"keyup",function(e){return ie(e,3)});var oe=function(t,n){if(!t)var t=e.event;var r=null,o=null;t.clientX&&t.clientY?(r=t.clientX,o=t.clientY):t.pageX&&t.pageY&&(r=t.pageX-e.pageXOffset,o=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),i(_,"mouseup",oe),J=null,!I&&n||Q&&Q(r,o,n)};r(K,"mousedown",function(e){i(_,"mouseup",oe),r(_,"mouseup",oe)}),r(K,"mouseup",function(e){oe(e),ne&&ne()}),r(K,"dblclick",function(e){oe(e)}),r(K,"selectionchange",function(e){oe(e)}),I&&r(K,"contextmenu",function(e){return oe(e,!0),a(e)});var ae=function(n,r,i){if(d(0,J),K.focus(),!b(K,i))return!1;if(e.getSelection)try{return!(t.queryCommandSupported&&!t.queryCommandSupported(n))&&t.execCommand(n,!1,r)}catch(e){}else if(t.selection){var o=t.selection;if("None"!=o.type){var a=o.createRange();try{return!!a.queryCommandEnabled(n)&&a.execCommand(n,!1,r)}catch(e){}}}return!1};e.FileReader&&r(K,"paste",function(e){var t=e.clipboardData;if(t){var n=t.items;if(n&&n.length){var r=n[0];if(r.type.match(/^image\//)){var i=new FileReader;return i.onloadend=function(e){var t=e.target.result;t&&ae("insertImage",t)},i.readAsDataURL(r.getAsFile()),a(e)}}}});var le=null,ue=function(){(t.all||e.MSInputMethodContext)&&(le=t.createElement("DIV"),K.appendChild(le))};return Y=function(e){le&&(K.removeChild(le),le=null),ne&&ne(),e?(v(),J=null):J&&(J=s())},{getElement:function(){return K},getHTML:function(){return K.innerHTML},setHTML:function(e){return K.innerHTML=e||"<br>",Y(!0),this},getSelectedHTML:function(){return d(0,J),b(K)?y(K):null},sync:function(){return V&&V(),this},readOnly:function(e){return void 0===e?K.hasAttribute?!K.hasAttribute("contentEditable"):!K.getAttribute("contentEditable"):(e?K.removeAttribute("contentEditable"):K.setAttribute("contentEditable","true"),this)},collapseSelection:function(){return v(),J=null,this},expandSelection:function(e,t){return d(0,J),b(K)?(m(0,e,t),J=s(),this):this},openPopup:function(){return J||(J=s()),ee()},closePopup:function(){return te(),this},removeFormat:function(){return ae("removeFormat"),ae("unlink"),Y(),this},bold:function(){return ae("bold"),Y(),this},italic:function(){return ae("italic"),Y(),this},underline:function(){return ae("underline"),Y(),this},strikethrough:function(){return ae("strikeThrough"),Y(),this},forecolor:function(e){return ae("foreColor",e),Y(),this},highlight:function(e){return ae("hiliteColor",e)||ae("backColor",e),Y(),this},fontName:function(e){return ae("fontName",e),Y(),this},fontSize:function(e){return ae("fontSize",e),Y(),this},subscript:function(){return ae("subscript"),Y(),this},superscript:function(){return ae("superscript"),Y(),this},align:function(e){return ue(),"left"==e?ae("justifyLeft"):"center"==e?ae("justifyCenter"):"right"==e?ae("justifyRight"):"justify"==e&&ae("justifyFull"),Y(),this},format:function(e){return ue(),ae("formatBlock",e),Y(),this},indent:function(e){return ue(),ae(e?"outdent":"indent"),Y(),this},insertLink:function(e){return ae("createLink",e),Y(!0),this},insertImage:function(e){return ae("insertImage",e,!0),Y(!0),this},insertHTML:function(e){return ae("insertHTML",e,!0)||(d(0,J),b(K,!0),T(K,e)),Y(!0),this},insertList:function(e){return ue(),ae(e?"insertOrderedList":"insertUnorderedList"),Y(),this}}}});
!function(e){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(t){return e(window,document,t)});else{if("undefined"==typeof exports)return e(window,document,jQuery);module.exports=e(window,document,require("jquery"))}}(function(e,t,n){"use strict";var o=function(e,t,n){var o,r,i,a,s,l,p,c;switch(a=Math.floor(6*e),s=6*e-a,l=n*(1-t),p=n*(1-s*t),c=n*(1-(1-s)*t),a%6){case 0:o=n,r=c,i=l;break;case 1:o=p,r=n,i=l;break;case 2:o=l,r=n,i=c;break;case 3:o=l,r=p,i=n;break;case 4:o=c,r=l,i=n;break;case 5:o=n,r=l,i=p}var u=Math.floor(255*o).toString(16),f=Math.floor(255*r).toString(16),d=Math.floor(255*i).toString(16);return"#"+(u.length<2?"0":"")+u+(f.length<2?"0":"")+f+(d.length<2?"0":"")+d},r=function(e){return e.replace(/[&<>"]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e]||e})},i=function(i,a,s,l,p,c,u,f,d,w,h,g,y,v,m,b,C,k){var P=function(e,t){t&&(e.getSelectedHTML()?e.insertLink(t):e.insertHTML('<a href="'+r(t)+'">'+r(t)+"</a>")),e.closePopup().collapseSelection()},x=function(e,t){var o=n('<input type="text" value="">').val(t?t.attr("href"):"").addClass("wysiwyg-input").keypress(function(n){10!=n.which&&13!=n.which||(t?(t.prop("href",o.val()),e.closePopup().collapseSelection()):P(e,o.val()))});f&&o.prop("placeholder",f);var r=n();c&&(r=I(c).click(function(n){return t?(t.prop("href",o.val()),e.closePopup().collapseSelection()):P(e,o.val()),n.stopPropagation(),n.preventDefault(),!1}));var i=n("<div/>").addClass("wysiwyg-toolbar-form").prop("unselectable","on");return i.append(o).append(r),i},L=function(t){var o=function(e,o){var i='<img id="wysiwyg-insert-image" src="" alt=""'+(o?' title="'+r(o)+'"':"")+">";t.insertHTML(i).closePopup().collapseSelection();var a=n("#wysiwyg-insert-image").removeAttr("id");w&&a.css({maxWidth:w[0]+"px",maxHeight:w[1]+"px"}).load(function(){a.css({maxWidth:"",maxHeight:""});var e=a.width(),t=a.height();(e>w[0]||t>w[1])&&(e/t>w[0]/w[1]?(t=parseInt(t/e*w[0]),e=w[0]):(e=parseInt(e/t*w[1]),t=w[1]),a.prop("width",e).prop("height",t))}),a.prop("src",e)},i=n("<div/>").addClass("wysiwyg-toolbar-form").prop("unselectable","on"),a=null,s=n('<input type="file">').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!y&&e.File&&e.FileReader&&e.FileList){var l=function(e){if(("function"!=typeof h||h(e))&&e.type.match(h)){var t=new FileReader;t.onload=function(t){var n=t.target.result;o(n,e.name)},t.readAsDataURL(e)}};a=s.prop("draggable","true").change(function(e){for(var t=e.target.files,n=0;n<t.length;++n)l(t[n])}).on("dragover",function(e){return e.originalEvent.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault(),!1}).on("drop",function(e){for(var t=e.originalEvent.dataTransfer.files,n=0;n<t.length;++n)l(t[n]);return e.stopPropagation(),e.preventDefault(),!1})}else if(g){var p=s.change(function(e){g.call(this,o)});a=n("<form/>").append(p)}a&&n("<div/>").addClass("wysiwyg-browse").html(u).append(a).appendTo(i);var d=n('<input type="text" value="">').addClass("wysiwyg-input").keypress(function(e){10!=e.which&&13!=e.which||o(d.val())});f&&d.prop("placeholder",f);var v=n();return c&&(v=I(c).click(function(e){return o(d.val()),e.stopPropagation(),e.preventDefault(),!1})),i.append(n("<div/>").append(d).append(v)),i},T=function(e){var t=function(t,o){t=n.trim(t||""),o=n.trim(o||"");var i=!1;t.length&&!o.length?i=t:-1==o.indexOf("<")&&-1==o.indexOf(">")&&o.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)&&(i=o),i&&v&&(o=v(i)||""),!o.length&&i&&(o='<video src="'+r(i)+'">'),e.insertHTML(o).closePopup().collapseSelection()},o=n("<div/>").addClass("wysiwyg-toolbar-form").prop("unselectable","on"),i=n("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");d&&i.prop("placeholder",d),n("<div/>").addClass("wysiwyg-embedcode").append(i).appendTo(o);var a=n('<input type="text" value="">').addClass("wysiwyg-input").keypress(function(e){10!=e.which&&13!=e.which||t(a.val())});f&&a.prop("placeholder",f);var s=n();return c&&(s=I(c).click(function(e){return t(a.val(),i.val()),e.stopPropagation(),e.preventDefault(),!1})),o.append(n("<div/>").append(a).append(s)),o},S=function(e,t){for(var r=n("<table/>").prop("cellpadding","0").prop("cellspacing","0").prop("unselectable","on"),i=1;i<15;++i){for(var a=n("<tr/>"),s=0;s<25;++s){var l;if(24==s){var p=Math.floor(255/13*(14-i)).toString(16),c=(p.length<2?"0":"")+p;l="#"+c+c+c}else l=o(s/24,i<=8?i/8:1,i>8?(16-i)/8:1);n("<td/>").addClass("wysiwyg-toolbar-color").prop("title",l).prop("unselectable","on").css({backgroundColor:l}).click(function(){var n=this.title;return t?e.forecolor(n).closePopup().collapseSelection():e.highlight(n).closePopup().collapseSelection(),!1}).appendTo(a)}r.append(a)}return r},j=function(e,t){switch(e){case"insertimage":return t?function(e){t(L(O),e)}:null;case"insertvideo":return t?function(e){t(T(O),e)}:null;case"insertlink":return t?function(e){t(x(O),e)}:null;case"bold":return function(){O.bold()};case"italic":return function(){O.italic()};case"underline":return function(){O.underline()};case"strikethrough":return function(){O.strikethrough()};case"forecolor":return t?function(e){t(S(O,!0),e)}:null;case"highlight":return t?function(e){t(S(O,!1),e)}:null;case"alignleft":return function(){O.align("left")};case"aligncenter":return function(){O.align("center")};case"alignright":return function(){O.align("right")};case"alignjustify":return function(){O.align("justify")};case"subscript":return function(){O.subscript()};case"superscript":return function(){O.superscript()};case"indent":return function(){O.indent()};case"outdent":return function(){O.indent(!0)};case"orderedList":return function(){O.insertList(!0)};case"unorderedList":return function(){O.insertList()};case"removeformat":return function(){O.removeFormat().closePopup().collapseSelection()}}return null},I=function(e){var t=n("<a/>").addClass("wysiwyg-toolbar-icon").prop("href","#").prop("unselectable","on").append(e.image);return n.each(e,function(e,n){switch(e){case"class":t.addClass(n);break;case"image":case"html":case"popup":case"click":case"showstatic":case"showselection":break;default:t.attr(e,n)}}),t},E=function(e,t,o,r){n.each(p,function(i,a){if(a&&(!(!1===t&&"showstatic"in a)||a.showstatic)&&(!(!0===t&&"showselection"in a)||a.showselection)){var s,l;(s="click"in a?function(e){a.click(n(e))}:"popup"in a?function(e){var t=o(),i=a.popup(t,n(e));r(t,e,i)}:j(i,function(e,t){var n=o();n.append(e),r(n,t),n.find("input[type=text]:first").focus()}))?l=I(a).click(function(e){return s(e.currentTarget),j(i)&&O.getElement().focus(),e.stopPropagation(),e.preventDefault(),!1}):a.html&&(l=n(a.html)),l&&e.append(l)}})},M=function(o,r,i,a){for(var s=r.get(0),l=s.offsetParent,p=0,c=0,u=!1,f=0,d=!1,w=!1,h=o.width(),g=l;g;){f+=g.offsetLeft,g.offsetTop;var y=n(g),v=y.css("position");"static"!=v?u=!0:u||(p+=g.offsetLeft,c+=g.offsetTop),"fixed"==v&&(d=!0),"visible"!=y.css("overflow")&&(w=!0),g=g.offsetParent}var m=n(l||t.body);m.append(o),i+=p+s.offsetLeft,a+=c+s.offsetTop,(d||w)&&(i+h>m.width()-1&&(i=m.width()-h-1),i<1&&(i=1));var b=n(e).width();f+i+h>b-1&&(i=b-f-h-1);var C=d?0:n(e).scrollLeft();f+i<C+1&&(i=C-f+1),o.css({left:parseInt(i)+"px",top:parseInt(a)+"px"})},D={},H=null,U=i.closest(".wysiwyg-container");0==U.length&&(U=n("<div/>").addClass("wysiwyg-container"),a&&U.addClass(a),i.wrap(U),U=i.closest(".wysiwyg-container"));var A=i.closest(".wysiwyg-wrapper");s&&0==A.length&&(A=n("<div/>").addClass("wysiwyg-wrapper"),i.wrap(A),A=i.closest(".wysiwyg-wrapper"));var F=null;0!=A.length&&(F=A.find(".wysiwyg-placeholder")),!s||F&&0!=F.length||(F=n("<div/>").addClass("wysiwyg-placeholder").html(s).hide(),A.prepend(F));var K=U.find(".wysiwyg-editor");0==K.length&&(K=null);var O=function(e,t,o,r){var i=function(e,t,o,r,i,a,l){if(k){var p=H||"";switch(t){case 8:p=p.substring(0,p.length-1);case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:if(e)return;o=!1;break;default:if(!e)return;p+=o}var c=k(p,t,o,r,i,a,l);if("object"!=typeof c||!c.length)return s.closePopup(),H=null,c;n(s.openPopup()).hide().addClass("wysiwyg-popup wysiwyg-popuphover").empty().append(c),H=p}},a={element:e.get(0),contenteditable:t?t.get(0):null,onKeyDown:function(e,t,n,o,r,a){if(m&&!1===m(e,t,n,o,r,a))return!1;if(t&&!n&&!o&&r&&!a){var s=t.toLowerCase();if(!D[s])return;return D[s](),!1}return i(!1,e,t,n,o,r,a)},onKeyPress:function(e,t,n,o,r,a){return(!b||!1!==b(e,t,n,o,r,a))&&i(!0,e,t,n,o,r,a)},onKeyUp:function(e,t,n,o,r,i){if(C&&!1===C(e,t,n,o,r,i))return!1},onSelection:function(t,o,r,i){var a=!0,p=null;if(t&&n.each(r,function(e,t){var o=n(t).closest("a");if(0!=o.length)return p=x(s,o),!1}),s.readOnly()?a=!1:o?p||i||H||(-1==n.inArray("selection",l.split("-"))?a=!1:t?a=!1:1==r.length&&"IMG"==r[0].nodeName&&(a=!1)):a=!1,a){var c,u=function(){var t=c.outerWidth(),r=e.parent(),i=r.offset(),a=n(s.getElement()).offset(),l=o.left+parseInt(o.width/2)-parseInt(t/2)+a.left-i.left,p=o.top+o.height+a.top-i.top;M(c,r,l,p)};(c=n(s.openPopup())).hasClass("wysiwyg-popuphover")&&!c.data("wysiwygjs-special")==!p||(c=n(s.closePopup().openPopup())),H?c.show():c.hasClass("wysiwyg-popup")||(c.addClass("wysiwyg-popup wysiwyg-popuphover"),p?c.empty().append(p).data("wysiwygjs-special",!0):E(c,!0,function(){return c.empty()},u)),u()}else s.closePopup()},onOpenpopup:function(){R()},onClosepopup:function(){H=null,$()},hijackContextmenu:"selection"==l,readOnly:!!e.prop("readonly")};r&&(a.onPlaceholder=function(e){e?r.show():r.hide()});var s=wysiwyg(a);return s}(i,K,0,F);if(O.legacy)K&&K.hide(),F&&F.hide(),(i=n(O.getElement())).show().addClass("wysiwyg-textarea"),i.is(":visible")&&i.width(U.width()-(i.outerWidth()-i.width()));else{K||n(O.getElement()).addClass("wysiwyg-editor"),A.click(function(){O.getElement().focus()});var W=null,q=null,R=function(){W&&clearTimeout(W),W=null,q&&(q(),q=null),U.addClass("wysiwyg-active"),U.find(".wysiwyg-toolbar-focus").slideDown(200)},$=function(){W||t.activeElement==O.getElement()||(W=setTimeout(function(){W=null,U.removeClass("wysiwyg-active"),0==n.trim(O.getHTML().replace(/<br\s*[\/]?>/gi,"")).length&&U.find(".wysiwyg-toolbar-focus").slideUp(200)},100))};n(O.getElement()).focus(R).blur($),i.closest("form").on("reset",$);var z={};if(n.each(p,function(e,t){if(t&&t.hotkey){var n=j(e);n&&(D[t.hotkey.toLowerCase()]=n,z[e]=n)}}),!n.isEmptyObject(p)&&"selection"!=l){var G=-1!=n.inArray("top",l.split("-")),N=-1!=n.inArray("focus",l.split("-")),Q=function(){var e=n("<div/>").addClass("wysiwyg-toolbar").addClass(G?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");N&&e.hide().addClass("wysiwyg-toolbar-focus"),E(e,!1,function(){var e=n(O.openPopup());return e.hasClass("wysiwyg-popup")&&e.hasClass("wysiwyg-popuphover")&&(e=n(O.closePopup().openPopup())),e.hasClass("wysiwyg-popup")||e.addClass("wysiwyg-popup"),e},function(e,t,o){var r=n(t),i=e.outerWidth(),a=r.offset().left-U.offset().left+parseInt(r.width()/2)-parseInt(i/2),s=r.offset().top-U.offset().top;G?s+=r.outerHeight():s-=e.outerHeight(),o&&(a=o.left,s=o.top),M(e,U,a,s)}),G?U.prepend(e):U.append(e)};N?q=Q:Q()}}return{wysiwygeditor:O,$container:U}};n.fn.wysiwyg=function(e,t){if(!e||"object"==typeof e)return e=n.extend({},e),this.each(function(){var t=n(this);if(!t.data("wysiwygjs")){var o=e.class,r=e.placeholder||t.prop("placeholder"),a=e.toolbar||"top",s=e.buttons||{},l=e.submit,p=e.selectImage,c=e.placeholderUrl||null,u=e.placeholderEmbed||null,f=e.maxImageSize||null,d=e.filterImageType||"^image/",w=e.onImageUpload||null,h=e.forceImageUpload&&w,g=e.videoFromUrl||null,y=e.onKeyDown||null,v=e.onKeyPress||null,m=e.onKeyUp||null,b=e.onAutocomplete||null,C=i(t,o,r,a,s,l,p,c,u,f,d,w,h,g,y,v,m,b);t.data("wysiwygjs",C)}});if(1==this.length){var o=this.data("wysiwygjs");if(!o)return this;if("container"==e)return o.$container;if("shell"==e)return o.wysiwygeditor}return this}});
!function(t){t.fn.kneditor=function(e){var i=t(this),a={fontsize:{title:"字体大小",image:"",popup:function(e,a){for(var r=[],n=8;n<=11;++n)r.push(n+"px");for(n=12;n<=28;n+=2)r.push(n+"px");r.push("36px"),r.push("48px"),r.push("72px");var o=t("<div/>").addClass("wysiwyg-plugin-list").attr("unselectable","on");t.each(r,function(e,a){var r=t("<a/>").attr("href","#").html(a).click(function(t){return i.wysiwyg("shell").fontSize(7).closePopup(),i.wysiwyg("container").find("font[size=7]").removeAttr("size").css("font-size",a),t.stopPropagation(),t.preventDefault(),!1});o.append(r)}),e.append(o)}},header:{title:"样式",image:"",popup:function(e,a){var r=t("<div/>").addClass("wysiwyg-plugin-list").attr("unselectable","on");t.each({"标题 1":"<h1>","标题 2":"<h2>","标题 3":"<h3>","标题 4":"<h4>","标题 5":"<h5>","标题 6":"<h6>"},function(e,a){var n=t("<a/>").attr("href","#").css("font-family",a).html(e).click(function(t){return i.wysiwyg("shell").format(a).closePopup(),t.stopPropagation(),t.preventDefault(),!1});r.append(n)}),e.append(r)}},bold:{title:"粗体 (Ctrl+B)",image:"",hotkey:"b"},italic:{title:"斜体 (Ctrl+I)",image:"",hotkey:"i"},underline:{title:"下划线 (Ctrl+U)",image:"",hotkey:"u"},strikethrough:{title:"删除线 (Ctrl+S)",image:"",hotkey:"s"},forecolor:{title:"字体颜色",image:""},highlight:{title:"背景颜色",image:""},alignleft:{title:"居左",image:""},aligncenter:{title:"居中",image:""},alignright:{title:"居右",image:""},alignjustify:{title:"适应",image:""},subscript:{title:"上标",image:""},superscript:{title:"下标",image:""},indent:{title:"增加缩进",image:""},outdent:{title:"减少缩进",image:""},orderedList:{title:"有序列表",image:""},unorderedList:{title:"无序列表",image:""},removeformat:{title:"移除格式",image:""},insertimage:{title:"插入图片",image:""},insertlink:{title:"插入链接",image:""}},r={};if(e&&e.buttons&&Array.isArray(e.buttons))for(var n=0;n<e.buttons.length;n++)r[e.buttons[n]]=a[e.buttons[n]];else r=a;t(this).wysiwyg({class:"kneditor",buttons:r,selectImage:"选择图片或者拖动图片到此处",placeholderUrl:"www.example.com",forceImageUpload:!0,onImageUpload:function(i){if(!e.upload||!e.upload.url)return console.error("upload.url未指定");var a="legacy-uploader-"+Math.random().toString(36).substring(2);t("<iframe>").attr("name",a).attr("style","display: none;").load(function(){var e=t(this).contents().find("body").text();e&&(i(e),t(this).remove())}).appendTo(document.body),t(this).attr("name",e.upload.name?e.upload.name:"file").parents("form").attr("action",e.upload.url).attr("method","POST").attr("enctype","multipart/form-data").attr("target",a).submit()}})}}(jQuery);